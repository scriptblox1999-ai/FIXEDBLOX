--[[==============================================================================================
||                                                                                          ||
||       HUB FARM UNIVERSAL - BLOX FRUITS (Sea 3 Bosses + Baús + Skills + Kill Aura)        ||
||                                                                                          ||
||    -> AutoFarm Baús + ServerHop                                                          ||
||    -> AutoFarm Bosses (Sea 3)                                                            ||
||    -> Kill Aura                                                                          ||
||    -> Auto Skill (Z,X,C,V)                                                               ||
||    -> Teleporte manual pros Bosses                                                       ||
||    -> Modo de Farm (Espada, Fruta, FightingStyle)                                        ||
||                                                                                          ||
==============================================================================================]]

-- SERVIÇOS
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local VU = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer

-- FLAGS
getgenv().AutoFarmChests = false
getgenv().AutoBossFarm = false
getgenv().KillAura = false
getgenv().AutoSkill = false
getgenv().FarmMode = "Espada"

-- CONFIG
local TELEPORT_SPEED = 300
local SCAN_INTERVAL = 1.5
local HOP_DELAY = 3

-- VARIÁVEIS
local UncheckedChests = {}
local FirstRun = true

-- LISTA DE BOSSES SEA 3
local Bosses = {
    ["Stone"] = {cf = CFrame.new(-1085, 40, 6779), name = "Stone"},
    ["Island Empress"] = {cf = CFrame.new(5780, 100, 1240), name = "Island Empress"},
    ["Kilo Admiral"] = {cf = CFrame.new(2850, 450, -7200), name = "Kilo Admiral"},
    ["Captain Elephant"] = {cf = CFrame.new(-13340, 470, -8400), name = "Captain Elephant"},
    ["Beautiful Pirate"] = {cf = CFrame.new(5200, 60, -11000), name = "Beautiful Pirate"}
}

-- FUNÇÕES BÁSICAS
local function getChar()
    if not LocalPlayer.Character then LocalPlayer.CharacterAdded:Wait() end
    return LocalPlayer.Character
end

local function teleportTo(destinationCFrame, speed)
    local char = getChar()
    local root = char:WaitForChild("HumanoidRootPart")
    local Magnitude = (root.Position - destinationCFrame.Position).Magnitude
    while Magnitude > 5 do
        local Direction = (destinationCFrame.Position - root.Position).Unit
        root.CFrame = root.CFrame + Direction * (speed or TELEPORT_SPEED) * task.wait()
        Magnitude = (root.Position - destinationCFrame.Position).Magnitude
    end
    root.CFrame = destinationCFrame
end

-- =================== AUTO SKILL ===================
local function useSkills()
    local keys = {"Z","X","C","V"}
    for _,k in pairs(keys) do
        VU:SendKeyEvent(true, k, false, game)
        task.wait(0.2)
        VU:SendKeyEvent(false, k, false, game)
        task.wait(0.4)
    end
end

task.spawn(function()
    while task.wait(1) do
        if getgenv().AutoSkill then
            useSkills()
        end
    end
end)

-- =================== KILL AURA ===================
task.spawn(function()
    while task.wait(0.3) do
        if getgenv().KillAura then
            local char = getChar()
            local root = char:FindFirstChild("HumanoidRootPart")
            if root then
                for _, mob in pairs(workspace.Enemies:GetChildren()) do
                    if mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") then
                        local dist = (mob.HumanoidRootPart.Position - root.Position).Magnitude
                        if dist < 35 and mob.Humanoid.Health > 0 then
                            VU:Button1Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
                            task.wait(0.05)
                            VU:Button1Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
                        end
                    end
                end
            end
        end
    end
end)

-- =================== AUTO FARM BAÚS ===================
local function sortByDistance(ObjectList: table)
    local RootPart = getChar().HumanoidRootPart
    table.sort(ObjectList, function(A, B)
        return (RootPart.Position - A.Position).Magnitude < (RootPart.Position - B.Position).Magnitude
    end)
end

local function getChestsSorted()
    if FirstRun then
        FirstRun = false
        for _, obj in pairs(game:GetDescendants()) do
            if obj.Name:find("Chest") and obj:IsA("Part") then
                table.insert(UncheckedChests, obj)
            end
        end
    end
    local Chests = {}
    for _, Chest in pairs(UncheckedChests) do
        if Chest and Chest.Parent and Chest:FindFirstChild("TouchInterest") then
            table.insert(Chests, Chest)
        end
    end
    sortByDistance(Chests)
    return Chests
end

local function serverHop()
    task.wait(HOP_DELAY)
    local PlaceId = game.PlaceId
    local function listServers()
        local url = "https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?sortOrder=Asc&limit=100"
        local body = game:HttpGet(url)
        return HttpService:JSONDecode(body)
    end
    local success, result = pcall(listServers)
    if success and result and result.data then
        for _, server in ipairs(result.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                TeleportService:TeleportToPlaceInstance(PlaceId, server.id, LocalPlayer)
                return
            end
        end
    end
    TeleportService:Teleport(PlaceId, LocalPlayer)
end

task.spawn(function()
    while task.wait(SCAN_INTERVAL) do
        if getgenv().AutoFarmChests then
            local Chests = getChestsSorted()
            if #Chests > 0 then
                for _, chest in ipairs(Chests) do
                    if chest and chest.Parent then
                        teleportTo(chest.CFrame * CFrame.new(0,2.5,0), TELEPORT_SPEED)
                        task.wait(0.2)
                    end
                end
            else
                serverHop()
            end
        end
    end
end)

-- =================== AUTO FARM BOSSES ===================
task.spawn(function()
    while task.wait(5) do
        if getgenv().AutoBossFarm then
            for boss, data in pairs(Bosses) do
                teleportTo(data.cf, TELEPORT_SPEED)
                task.wait(1)
                for _, mob in pairs(workspace.Enemies:GetChildren()) do
                    if mob.Name == data.name and mob:FindFirstChild("Humanoid") then
                        while mob.Humanoid.Health > 0 and getgenv().AutoBossFarm do
                            VU:Button1Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
                            task.wait(0.05)
                            VU:Button1Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
                            if getgenv().AutoSkill then useSkills() end
                            task.wait(0.3)
                        end
                    end
                end
            end
        end
    end
end)

-- =================== GUI ===================
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local Frame = Instance.new("Frame", ScreenGui)
local UICorner = Instance.new("UICorner", Frame)
Frame.Size = UDim2.new(0, 280, 0, 400)
Frame.Position = UDim2.new(0.05, 0, 0.25, 0)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
UICorner.CornerRadius = UDim.new(0, 12)

local function createBtn(y, text, callback)
    local Btn = Instance.new("TextButton", Frame)
    Btn.Size = UDim2.new(0, 260, 0, 35)
    Btn.Position = UDim2.new(0, 10, 0, y)
    Btn.Text = text
    Btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    Btn.Font = Enum.Font.SourceSansBold
    Btn.TextSize = 16
    Btn.MouseButton1Click:Connect(function() callback(Btn) end)
    return Btn
end

local BtnFarmChest = createBtn(10, "Auto Farm Baús: OFF", function(self)
    getgenv().AutoFarmChests = not getgenv().AutoFarmChests
    self.Text = "Auto Farm Baús: " .. (getgenv().AutoFarmChests and "ON" or "OFF")
end)

local BtnKA = createBtn(55, "Kill Aura: OFF", function(self)
    getgenv().KillAura = not getgenv().KillAura
    self.Text = "Kill Aura: " .. (getgenv().KillAura and "ON" or "OFF")
end)

local BtnSkill = createBtn(100, "Auto Skill: OFF", function(self)
    getgenv().AutoSkill = not getgenv().AutoSkill
    self.Text = "Auto Skill: " .. (getgenv().AutoSkill and "ON" or "OFF")
end)

local BtnMode = createBtn(145, "Modo: Espada", function(self)
    if getgenv().FarmMode == "Espada" then
        getgenv().FarmMode = "Fruta"
    elseif getgenv().FarmMode == "Fruta" then
        getgenv().FarmMode = "FightingStyle"
    else
        getgenv().FarmMode = "Espada"
    end
    self.Text = "Modo: " .. getgenv().FarmMode
end)

local BtnBossFarm = createBtn(190, "Auto Boss Farm: OFF", function(self)
    getgenv().AutoBossFarm = not getgenv().AutoBossFarm
    self.Text = "Auto Boss Farm: " .. (getgenv().AutoBossFarm and "ON" or "OFF")
end)

-- Botões de teleporte manual pros bosses
local y = 235
for name, data in pairs(Bosses) do
    createBtn(y, "Teleport: "..name, function()
        teleportTo(data.cf, TELEPORT_SPEED)
    end)
    y = y + 40
end
